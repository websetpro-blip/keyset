# –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –†–ê–°–ü–†–ï–î–ï–õ–ï–ù–ò–ï –§–†–ê–ó –ò –≠–ö–°–ü–û–†–¢ CSV

**–î–∞—Ç–∞:** 26.10.2025
**–§–∞–π–ª:** `c:\AI\yandex\keyset\app\tabs\parsing_tab.py`
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

---

## üéØ –ü–†–û–ë–õ–ï–ú–´

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—Ä–∞–∑ –º–µ–∂–¥—É –±—Ä–∞—É–∑–µ—Ä–∞–º–∏
**–°–∏–º–ø—Ç–æ–º:** –í—Å–µ 5 –±—Ä–∞—É–∑–µ—Ä–æ–≤ –ø–∞—Ä—Å–∏–ª–∏ –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ 1000 —Ñ—Ä–∞–∑ ‚Üí 5000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–º–µ—Å—Ç–æ 1000

**–ü—Ä–∏—á–∏–Ω–∞:**
```python
# –ë–´–õ–û (—Å—Ç—Ä–æ–∫–∞ 199 - —Å—Ç–∞—Ä–∞—è)
for profile in selected_profiles:
    task = SingleParsingTask(
        phrases=self.phrases,  # ‚ùå –í–°–ï —Ñ—Ä–∞–∑—ã –∫–∞–∂–¥–æ–º—É!
        ...
    )
```

**–†–µ—à–µ–Ω–∏–µ:** –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—Ä–∞–∑ –ø–æ—Ä–æ–≤–Ω—É –º–µ–∂–¥—É –ø—Ä–æ—Ñ–∏–ª—è–º–∏
- 1000 —Ñ—Ä–∞–∑ √∑ 5 –ø—Ä–æ—Ñ–∏–ª–µ–π = 200 —Ñ—Ä–∞–∑ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å
- –ü—Ä–æ—Ñ–∏–ª—å 1 ‚Üí —Ñ—Ä–∞–∑—ã [0:200]
- –ü—Ä–æ—Ñ–∏–ª—å 2 ‚Üí —Ñ—Ä–∞–∑—ã [200:400]
- –ü—Ä–æ—Ñ–∏–ª—å 3 ‚Üí —Ñ—Ä–∞–∑—ã [400:600]
- –ü—Ä–æ—Ñ–∏–ª—å 4 ‚Üí —Ñ—Ä–∞–∑—ã [600:800]
- –ü—Ä–æ—Ñ–∏–ª—å 5 ‚Üí —Ñ—Ä–∞–∑—ã [800:1000]

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –õ–∏—à–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ CSV
**–°–∏–º–ø—Ç–æ–º:** CSV —Å–æ–¥–µ—Ä–∂–∞–ª 8 –∫–æ–ª–æ–Ω–æ–∫: –§—Ä–∞–∑–∞, WS, "WS", !WS, –°—Ç–∞—Ç—É—Å, –ü—Ä–æ—Ñ–∏–ª—å, –í—Ä–µ–º—è, –î–µ–π—Å—Ç–≤–∏—è

**–ñ–µ–ª–∞–µ–º–æ–µ:** –¢–æ–ª—å–∫–æ 2 –∫–æ–ª–æ–Ω–∫–∏: –§—Ä–∞–∑–∞, –ß–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç—å

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—Ä–∞–∑ (—Å—Ç—Ä–æ–∫–∏ 192-218)

**–§–∞–π–ª:** [parsing_tab.py:192-218](c:\AI\yandex\keyset\app\tabs\parsing_tab.py#L192-L218)

```python
# –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—Ä–∞–∑—ã –ø–æ—Ä–æ–≤–Ω—É –º–µ–∂–¥—É –ø—Ä–æ—Ñ–∏–ª—è–º–∏
num_profiles = len(selected_profiles)
phrases_per_profile = len(phrases) // num_profiles
remainder = len(phrases) % num_profiles

batches = []
start_idx = 0

for i in range(num_profiles):
    # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ –æ–¥–Ω–æ–π —Ñ—Ä–∞–∑–µ –∫ –ø–æ—Å–ª–µ–¥–Ω–∏–º –ø—Ä–æ—Ñ–∏–ª—è–º –µ—Å–ª–∏ –µ—Å—Ç—å –æ—Å—Ç–∞—Ç–æ–∫
    end_idx = start_idx + phrases_per_profile + (1 if i >= num_profiles - remainder else 0)
    batch = phrases[start_idx:end_idx]
    batches.append(batch)
    start_idx = end_idx

# –°–æ–∑–¥–∞–µ–º –∑–∞–¥–∞—á–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è —Å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º–∏ —Ñ—Ä–∞–∑–∞–º–∏
self.tasks = []
for profile, batch in zip(selected_profiles, batches):
    task = SingleParsingTask(
        profile_email=profile['email'],
        profile_path=profile['profile_path'],
        proxy=profile.get('proxy'),
        phrases=batch,  # ‚úÖ –ö–∞–∂–¥—ã–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—É—á–∞–µ—Ç –¢–û–õ–¨–ö–û —Å–≤–æ–π –±–∞—Ç—á —Ñ—Ä–∞–∑
        session_id=self.session_id,
        cookie_count=profile.get("cookie_count"),
    )
    self.tasks.append(task)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ö–∞–∂–¥—ã–π –±—Ä–∞—É–∑–µ—Ä –ø–∞—Ä—Å–∏—Ç –°–í–û–ò —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ñ—Ä–∞–∑—ã
- –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –í 5 —Ä–∞–∑ –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Wordstat API

### 2. –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç CSV (—Å—Ç—Ä–æ–∫–∏ 807-863)

**–§–∞–π–ª:** [parsing_tab.py:807-863](c:\AI\yandex\keyset\app\tabs\parsing_tab.py#L807-L863)

```python
def _on_export_clicked(self):
    """–≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ CSV —Å 2 –∫–æ–ª–æ–Ω–∫–∞–º–∏: –§—Ä–∞–∑–∞ –∏ –ß–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç—å"""
    # –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ: —Ñ—Ä–∞–∑–∞ + WS (–∫–æ–ª–æ–Ω–∫–∞ 0 –∏ 1)
    export_data = []
    for row in range(self.table.rowCount()):
        phrase_item = self.table.item(row, 0)  # –ö–æ–ª–æ–Ω–∫–∞ "–§—Ä–∞–∑–∞"
        ws_item = self.table.item(row, 1)      # –ö–æ–ª–æ–Ω–∫–∞ "WS"

        if phrase_item and ws_item:
            phrase = phrase_item.text()
            ws_text = ws_item.text()

            # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —á–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç—å –≤ —á–∏—Å–ª–æ
            try:
                ws_value = int(float(ws_text)) if ws_text else 0
            except (ValueError, TypeError):
                ws_value = 0

            export_data.append({
                'phrase': phrase,
                'frequency': ws_value
            })

    # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —á–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç–∏ (–ø–æ —É–±—ã–≤–∞–Ω–∏—é - —Å–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å–≤–µ—Ä—Ö—É)
    export_data.sort(key=lambda x: x['frequency'], reverse=True)

    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ CSV
    with open(file_path, 'w', newline='', encoding='utf-8-sig') as f:
        writer = csv.writer(f, quoting=csv.QUOTE_MINIMAL)

        # –ó–∞–≥–æ–ª–æ–≤–∫–∏ (—Ç–æ–ª—å–∫–æ 2 –∫–æ–ª–æ–Ω–∫–∏)
        writer.writerow(['–§—Ä–∞–∑–∞', '–ß–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç—å'])

        # –î–∞–Ω–Ω—ã–µ
        for item in export_data:
            writer.writerow([item['phrase'], item['frequency']])
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –¢–æ–ª—å–∫–æ 2 –∫–æ–ª–æ–Ω–∫–∏ –≤ CSV
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —á–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç–∏ (–ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å–≤–µ—Ä—Ö—É)
- UTF-8 —Å BOM (–¥–ª—è Excel)
- –ú–∏–Ω–∏–º—É–º –∫–∞–≤—ã—á–µ–∫ (`csv.QUOTE_MINIMAL`)

---

## üìä –ü–†–ò–ú–ï–† –†–ï–ó–£–õ–¨–¢–ê–¢–ê

### –î–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```
–§—Ä–∞–∑–∞,WS,"""""WS""",!WS,–°—Ç–∞—Ç—É—Å,–ü—Ä–æ—Ñ–∏–ª—å,–í—Ä–µ–º—è,–î–µ–π—Å—Ç–≤–∏—è
—Ä–µ–º–æ–Ω—Ç –∫–≤–∞—Ä—Ç–∏—Ä—ã,2687.0,0,0,OK,kuznepetya,02:25:11,‚ãØ
...
```

### –ü–û–°–õ–ï (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```
–§—Ä–∞–∑–∞,–ß–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç—å
—Ä–µ–º–æ–Ω—Ç –∫–≤–∞—Ä—Ç–∏—Ä –ø–æ–¥ –∫–ª—é—á,56262
–∫—É–ø–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É –º–æ—Å–∫–≤–∞,615470
–¥–æ—Å—Ç–∞–≤–∫–∞ –µ–¥—ã –Ω–∞ –¥–æ–º,55432
...
```

---

## üöÄ –ö–ê–ö –¢–ï–°–¢–ò–†–û–í–ê–¢–¨

### –¢–µ—Å—Ç 1: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—Ä–∞–∑
1. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ñ–∞–π–ª —Å 1000 —Ñ—Ä–∞–∑–∞–º–∏
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –Ω–∞ 5 –ø—Ä–æ—Ñ–∏–ª—è—Ö
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –ë—Ä–∞—É–∑–µ—Ä 1: ~200 —Ñ—Ä–∞–∑
   - –ë—Ä–∞—É–∑–µ—Ä 2: ~200 —Ñ—Ä–∞–∑
   - –ë—Ä–∞—É–∑–µ—Ä 3: ~200 —Ñ—Ä–∞–∑
   - –ë—Ä–∞—É–∑–µ—Ä 4: ~200 —Ñ—Ä–∞–∑
   - –ë—Ä–∞—É–∑–µ—Ä 5: ~200 —Ñ—Ä–∞–∑
   - –í—Å–µ–≥–æ: 1000 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ñ—Ä–∞–∑ (–±–µ–∑ –¥—É–±–ª–µ–π)

### –¢–µ—Å—Ç 2: –≠–∫—Å–ø–æ—Ä—Ç CSV
1. –ü–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–≠–∫—Å–ø–æ—Ä—Ç"
2. –û—Ç–∫—Ä—ã—Ç—å CSV –≤ Excel –∏–ª–∏ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –¢–æ–ª—å–∫–æ 2 –∫–æ–ª–æ–Ω–∫–∏: "–§—Ä–∞–∑–∞" –∏ "–ß–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç—å"
   - –ó–∞–ø–∏—Å–∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —É–±—ã–≤–∞–Ω–∏—é —á–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç–∏
   - –ù–µ—Ç –ª–∏—à–Ω–∏—Ö –∫–∞–≤—ã—á–µ–∫
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞ UTF-8

---

## üìà –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨

### –î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- 5 –±—Ä–∞—É–∑–µ—Ä–æ–≤ √ó 1000 —Ñ—Ä–∞–∑ = **5000 –∑–∞–ø—Ä–æ—Å–æ–≤**
- –í—Ä–µ–º—è: ~300 —Å–µ–∫ (–ø—Ä–∏ 10 —Ñ—Ä–∞–∑/—Å–µ–∫ √ó 5 –±—Ä–∞—É–∑–µ—Ä–æ–≤)
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ: –¥–∞, –∫–∞–∂–¥–∞—è —Ñ—Ä–∞–∑–∞ –ø–æ 5 —Ä–∞–∑

### –ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- 5 –±—Ä–∞—É–∑–µ—Ä–æ–≤ √ó 200 —Ñ—Ä–∞–∑ = **1000 –∑–∞–ø—Ä–æ—Å–æ–≤**
- –í—Ä–µ–º—è: ~60 —Å–µ–∫ (–ø—Ä–∏ 10 —Ñ—Ä–∞–∑/—Å–µ–∫ √ó 5 –±—Ä–∞—É–∑–µ—Ä–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ: –Ω–µ—Ç
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ: –≤ 5 —Ä–∞–∑** üöÄ

---

## ‚úÖ –ß–ï–ö-–õ–ò–°–¢

- [x] –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—Ä–∞–∑ –º–µ–∂–¥—É –ø—Ä–æ—Ñ–∏–ª—è–º–∏
- [x] –ê–ª–≥–æ—Ä–∏—Ç–º —É—á–∏—Ç—ã–≤–∞–µ—Ç –æ—Å—Ç–∞—Ç–æ–∫ (–µ—Å–ª–∏ 1003 —Ñ—Ä–∞–∑—ã ‚Üí 201+201+201+200+200)
- [x] –≠–∫—Å–ø–æ—Ä—Ç CSV —Å 2 –∫–æ–ª–æ–Ω–∫–∞–º–∏
- [x] –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —á–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç–∏
- [x] UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫–∞
- [x] –ú–∏–Ω–∏–º—É–º –∫–∞–≤—ã—á–µ–∫
- [x] –°–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–æ–≤–µ—Ä–µ–Ω (`py_compile`)

---

**–ê–≤—Ç–æ—Ä:** Claude (AI Assistant)
**Encoding:** UTF-8
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** –°–∏–Ω—Ç–∞–∫—Å–∏—Å –≤–∞–ª–∏–¥–µ–Ω, –∏–º–ø–æ—Ä—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
