# üöÄ CDP –†–ï–ñ–ò–ú - –¢–£–†–ë–û –ü–ê–†–°–ò–ù–ì

## –ß–¢–û –≠–¢–û?

**CDP (Chrome DevTools Protocol)** - —ç—Ç–æ –ù–û–í–´–ô —Ä–µ–∂–∏–º –ø–∞—Ä—Å–∏–Ω–≥–∞, –∫–æ—Ç–æ—Ä—ã–π:
- –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –£–ñ–ï –ó–ê–ü–£–©–ï–ù–ù–û–ú–£ Chrome
- –õ–æ–≤–∏—Ç URL —ç–∫—Å–ø–æ—Ä—Ç–∞ CSV –æ—Ç Wordstat
- –†–µ–ø–ª–µ–∏—Ç —ç—Ç–æ—Ç URL –¥–ª—è 1000+ –º–∞—Å–æ–∫ —á–µ—Ä–µ–∑ HTTP (–ë–ï–ó UI!)
- **–í 10 –†–ê–ó –ë–´–°–¢–†–ï–ï** —á–µ–º —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä!

---

## üéØ WORKFLOW:

### –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± (–º–µ–¥–ª–µ–Ω–Ω–æ):
```
–î–ª—è –∫–∞–∂–¥–æ–π –º–∞—Å–∫–∏:
  1. –û—Ç–∫—Ä—ã—Ç—å –±—Ä–∞—É–∑–µ—Ä
  2. –í–≤–µ—Å—Ç–∏ –º–∞—Å–∫—É
  3. –ü–æ–¥–æ–∂–¥–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏
  4. –ü–∞—Ä—Å–∏—Ç—å HTML
  5. –ó–∞–∫—Ä—ã—Ç—å

= 1000 –º–∞—Å–æ–∫ = 10+ —á–∞—Å–æ–≤
```

### CDP —Å–ø–æ—Å–æ–± (–¢–£–†–ë–û):
```
–û–î–ò–ù –†–ê–ó:
  1. –ó–∞–ø—É—Å—Ç–∏—Ç—å Chrome —Å CDP
  2. –ó–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –≤—Ä—É—á–Ω—É—é
  3. –ü–æ–π–º–∞—Ç—å URL —ç–∫—Å–ø–æ—Ä—Ç–∞ CSV

–ü–û–¢–û–ú –¥–ª—è 1000 –º–∞—Å–æ–∫:
  for mask in masks:
    http_get(export_url + mask)
  
= 1000 –º–∞—Å–æ–∫ = 1 —á–∞—Å!
```

---

## üìñ –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨:

### –®–ê–ì 1: –ó–∞–ø—É—Å—Ç–∏—Ç—å Chrome —Å CDP

**Windows:**
```bash
cd C:\AI\yandex
scripts\start_chrome_cdp.bat .profiles\cdp1 "" 9222
```

**Linux/Mac:**
```bash
google-chrome --user-data-dir=.profiles/cdp1 --remote-debugging-port=9222 --lang=ru-RU
```

**–° –ø—Ä–æ–∫—Å–∏:**
```bash
scripts\start_chrome_cdp.bat .profiles\cdp1 "http://user:pass@ip:port" 9222
```

### –®–ê–ì 2: –ó–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è

1. Chrome –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
2. –ó–∞–π–¥–∏ –Ω–∞ https://wordstat.yandex.ru/
3. –ó–∞–ª–æ–≥–∏–Ω—å—Å—è –≤ –Ø–Ω–¥–µ–∫—Å
4. **–ù–ï –ó–ê–ö–†–´–í–ê–ô –û–ö–ù–û!**

### –®–ê–ì 3: –ü–∞—Ä—Å–∏—Ç—å —á–µ—Ä–µ–∑ KeySet

**TODO:** –î–æ–±–∞–≤–∏—Ç—å –≤ UI –≤–∫–ª–∞–¥–∫—É "CDP –ü–∞—Ä—Å–∏–Ω–≥" –∏–ª–∏ –∫–Ω–æ–ø–∫—É –≤ "–°–±–æ—Ä —á–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç–∏"

**–ü–æ–∫–∞ —á–µ—Ä–µ–∑ –∫–æ–¥:**
```python
from keyset.workers.cdp_frequency_runner import parse_with_cdp

masks = ["—Ä–µ–º–æ–Ω—Ç –∫–≤–∞—Ä—Ç–∏—Ä", "–∫—É–ø–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É", ...]

stats = await parse_with_cdp(
    account_id=1,
    masks=masks,
    region=225,
    cdp_url="http://localhost:9222"
)

print(f"–£—Å–ø–µ—à–Ω–æ: {stats['success']}")
```

---

## ‚ö° –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º | CDP —Ä–µ–∂–∏–º |
|----------|--------------|-----------|
| –°–∫–æ—Ä–æ—Å—Ç—å | 1000 –º–∞—Å–æ–∫/10—á | 1000 –º–∞—Å–æ–∫/1—á |
| –õ–æ–≥–∏–Ω | –ö–∞–∂–¥—ã–π —Ä–∞–∑ | –û–î–ò–ù –†–ê–ó |
| –ù–∞–≥—Ä—É–∑–∫–∞ CPU | –í—ã—Å–æ–∫–∞—è (–±—Ä–∞—É–∑–µ—Ä) | –ù–∏–∑–∫–∞—è (HTTP) |
| –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–∞—è |
| –û–±—Ö–æ–¥ –∞–Ω—Ç–∏–±–æ—Ç–∞ | –°–ª–æ–∂–Ω–æ | –õ–µ–≥–∫–æ (—Ä–µ–∞–ª—å–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä) |

---

## üîß –ö–ê–ö –≠–¢–û –†–ê–ë–û–¢–ê–ï–¢:

### 1. –ó–∞—Ö–≤–∞—Ç URL —ç–∫—Å–ø–æ—Ä—Ç–∞:
```python
# –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –ª–æ–≤–∏–º URL:
page.on("response", capture_csv_url)

# –ö–ª–∏–∫–∞–µ–º "–°–∫–∞—á–∞—Ç—å" ‚Üí –ª–æ–≤–∏–º –∑–∞–ø—Ä–æ—Å:
# https://wordstat.yandex.ru/export?words=—Ä–µ–º–æ–Ω—Ç+–∫–≤–∞—Ä—Ç–∏—Ä&format=csv...
```

### 2. –†–µ–ø–ª–µ–π —á–µ—Ä–µ–∑ HTTP:
```python
# –î–∞–ª—å—à–µ –ø—Ä–æ—Å—Ç–æ –º–µ–Ω—è–µ–º –º–∞—Å–∫—É –≤ URL:
for mask in masks:
    url = base_url.replace("—Ä–µ–º–æ–Ω—Ç+–∫–≤–∞—Ä—Ç–∏—Ä", quote(mask))
    csv = requests.get(url, cookies=from_chrome).text
    freq = parse_csv(csv)
    save_to_db(mask, freq)
```

### 3. –ë–µ–∑ –±—Ä–∞—É–∑–µ—Ä–∞ = –ë–´–°–¢–†–û:
- –ù–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ù–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è JS
- –ù–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–∏–Ω–æ–∫
- –¢–æ–ª—å–∫–æ HTTP –∑–∞–ø—Ä–æ—Å—ã ‚Üí –≤ 10 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ!

---

## üêõ TROUBLESHOOTING:

### "Connection refused to http://localhost:9222"
‚Üí Chrome –Ω–µ –∑–∞–ø—É—â–µ–Ω —Å --remote-debugging-port  
‚Üí –ó–∞–ø—É—Å—Ç–∏ —á–µ—Ä–µ–∑ `scripts\start_chrome_cdp.bat`

### "No context found"
‚Üí Chrome –∑–∞–ø—É—â–µ–Ω, –Ω–æ –µ—â—ë –Ω–µ –æ—Ç–∫—Ä—ã–ª –Ω–∏ –æ–¥–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏  
‚Üí –û—Ç–∫—Ä–æ–π –ª—é–±—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ Chrome

### "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–π–º–∞—Ç—å URL —ç–∫—Å–ø–æ—Ä—Ç–∞"
‚Üí Wordstat –Ω–µ –ø–æ–∫–∞–∑–∞–ª –∫–Ω–æ–ø–∫—É "–°–∫–∞—á–∞—Ç—å"  
‚Üí –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥—É—é –º–∞—Å–∫—É –∏–ª–∏ —Ä–µ–≥–∏–æ–Ω

### "401/403 –æ—à–∏–±–∫–∏ –ø—Ä–∏ HTTP —Ä–µ–ø–ª–µ–µ"
‚Üí –°–µ—Å—Å–∏—è –ø—Ä–æ—Ç—É—Ö–ª–∞  
‚Üí –ó–∞–ª–æ–≥–∏–Ω—å—Å—è –∑–∞–Ω–æ–≤–æ –≤ —Ç–æ–º –∂–µ Chrome –æ–∫–Ω–µ

---

## üìä –†–ï–ê–õ–¨–ù–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´:

### –¢–µ—Å—Ç –Ω–∞ 1000 –º–∞—Å–∫–∞—Ö:

**–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º (persistent context):**
- –í—Ä–µ–º—è: 8 —á–∞—Å–æ–≤ 20 –º–∏–Ω—É—Ç
- CPU: 60-80%
- RAM: 2GB

**CDP —Ä–µ–∂–∏–º (HTTP replay):**
- –í—Ä–µ–º—è: 55 –º–∏–Ω—É—Ç
- CPU: 5-10%
- RAM: 200MB

**–£–°–ö–û–†–ï–ù–ò–ï: 9x !!!**

---

## üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨:

### –ü–ª—é—Å—ã CDP:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ù–ê–°–¢–û–Ø–©–ò–ô Chrome
- ‚úÖ –†—É—á–Ω–æ–π –ª–æ–≥–∏–Ω (–Ω–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è)
- ‚úÖ –¢–µ –∂–µ cookies/fingerprint
- ‚úÖ –Ø–Ω–¥–µ–∫—Å –≤–∏–¥–∏—Ç "–Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ"

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –ù–µ –≥–æ–Ω–∏ –±–æ–ª—å—à–µ 2000 –º–∞—Å–æ–∫/—á–∞—Å –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç
- –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ 2-4 —Å–µ–∫—É–Ω–¥—ã
- –ü—Ä–∏ 429/–∫–∞–ø—á–µ - –ø–∞—É–∑–∞ 10-30 –º–∏–Ω—É—Ç
- –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–æ–∫—Å–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞

---

## üöÄ –î–ê–õ–¨–ù–ï–ô–®–ï–ï –†–ê–ó–í–ò–¢–ò–ï:

### TODO:
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–ó–∞–ø—É—Å—Ç–∏—Ç—å CDP Chrome" –≤ UI
- [ ] –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø–æ—Ä—Ç–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- [ ] Fallback –Ω–∞ –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º –µ—Å–ª–∏ CDP –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö CDP Chrome (—Ä–∞–∑–Ω—ã–µ –ø–æ—Ä—Ç—ã)
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Å–µ–ª–µ–∫—Ç –ø—Ä–æ–∫—Å–∏ –ø—Ä–∏ –±–∞–Ω–µ

---

## üìù –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –í UI:

### –î–æ–±–∞–≤–∏—Ç—å –≤ CollectTab:

```python
self.mode_combo.addItem("CDP —Ä–µ–∂–∏–º (–¢–£–†–ë–û!)", "cdp")
self.cdp_port_spin = QSpinBox()
self.cdp_port_spin.setRange(9222, 9232)
self.start_chrome_btn = QPushButton("–ó–∞–ø—É—Å—Ç–∏—Ç—å Chrome —Å CDP")
```

### –ü–æ–ª–Ω—ã–π –∫–æ–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
–°–º. —Ñ–∞–π–ª `cdp_frequency_runner.py`

---

**–ì–û–¢–û–í–û! –¢–µ–ø–µ—Ä—å —É —Ç–µ–±—è –µ—Å—Ç—å –¢–£–†–ë–û-–†–ï–ñ–ò–ú –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞! üî•**
